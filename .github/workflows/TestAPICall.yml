name: Test API Call

on: 
  workflow_dispatch:

jobs:
  post_api_call:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Make API Call
      run: |
        apiUrl="https://empkiranv01.service-now.com/api/sn_devops/v1/devops/tool/test?toolId=66434870c3b54e109b11243599013181&testType=Smoke"
        requestBody='{
          "name": "Test summary Smoke",
          "duration": 0,
          "passedTests": 1,
          "failedTests": 1,
          "skippedTests": 1,
          "blockedTests": 1,
          "totalTests": 4,
          "startTime": "2023-12-14T23:31:31z",
          "finishTime": "2023-12-15T23:31:31z",
          "stageName": "Make API Call",
          "pipelineName": "TestAPICall",
          "toolId": "66434870c3b54e109b11243599013181",
          "buildNumber": '${{ github.run_number }}',
          "buildId": '${{ github.run_id }}',
          "attemptNumber": '${{ github.run_attempt }}',
          "workflow": "'${{ github.workflow }}'",
          "repository": "'${{ github.repository }}'",
          "testType": "Smoke",
          "errorMessage": "",
          "fileContent": ""
        }'
        auth="ZGV2b3BzLmludGVncmF0aW9uLnVzZXI6VGVzdGluZzEh"
        authHeader="Basic $auth"
  
        response=$(curl -X POST -H "Content-Type: application/json" -H "Authorization: $authHeader" -d "$requestBody" $apiUrl)
        exitCode=$?
        
        if [ $exitCode -eq 0 ]; then
          echo "API call successful!"
          echo "Response: $response"
        else
          echo "API call failed!"
          echo "Response: $response"
          exit 1
        fi
